-- Generated by Oracle SQL Developer Data Modeler 20.4.0.374.0801
--   at:        2022-01-27 02:02:00 EET
--   site:      Oracle Database 12c
--   type:      Oracle Database 12c

DROP TABLE wydzialy CASCADE CONSTRAINTS;
DROP TABLE kierunki CASCADE CONSTRAINTS;
DROP TABLE stanowiska CASCADE CONSTRAINTS;
DROP TABLE tytuly CASCADE CONSTRAINTS;
DROP TABLE statusy CASCADE CONSTRAINTS;
DROP TABLE studenci CASCADE CONSTRAINTS;
DROP TABLE oceny CASCADE CONSTRAINTS;
DROP TABLE roki CASCADE CONSTRAINTS;
DROP TABLE semestry_roki CASCADE CONSTRAINTS;
DROP TABLE semestry CASCADE CONSTRAINTS;
DROP TABLE przedmioty CASCADE CONSTRAINTS;
DROP TABLE prac_uczelni CASCADE CONSTRAINTS;
DROP TABLE przedmioty_prac_uczleni CASCADE CONSTRAINTS;

-- predefined type, no DDL - MDSYS.SDO_GEOMETRY

-- predefined type, no DDL - XMLTYPE

CREATE TABLE kierunki (
    wydziały_id_wydziału  INTEGER NOT NULL,
    id_kierunku           INTEGER NOT NULL,
    nazwa_kierunku        VARCHAR2(50) NOT NULL
);

ALTER TABLE kierunki ADD CONSTRAINT kierunek_pk PRIMARY KEY ( id_kierunku );

CREATE TABLE oceny (
    id_oceny                      INTEGER NOT NULL,
    przedmioty_id_przedmiotu      INTEGER NOT NULL,
    student_nr_indeksu            NUMBER(6) NOT NULL,
    pracownicy_id_pracowniku      INTEGER NOT NULL,
    wartosc_oceny                 NUMBER(1, 1) NOT NULL,
    termin_wystawienia            DATE NOT NULL,
    czy_poprawiona                NUMBER NOT NULL,
    nr_indeksu                    NUMBER NOT NULL,
    prac_uczelni_prac_uczelni_id  NUMBER NOT NULL
);

ALTER TABLE oceny
    ADD CHECK ( wartosc_oceny >= 2
                AND wartosc_oceny <= 5 );

ALTER TABLE oceny ADD CONSTRAINT ocena_pk PRIMARY KEY ( id_oceny );

CREATE TABLE prac_uczelni (
    prac_uczelni_id      NUMBER NOT NULL,
    id_pracowniku        INTEGER NOT NULL,
    pesel                NUMBER(11) NOT NULL,
    imie                 VARCHAR2(50) NOT NULL,
    nazwisko             VARCHAR2(50) NOT NULL,
    plec                 VARCHAR2(20) NOT NULL,
    adres                VARCHAR2(150) NOT NULL,
    data_urodzenia       DATE NOT NULL,
    narodowosc           VARCHAR2(50) NOT NULL,
    telefon              VARCHAR2(30),
    tytul                VARCHAR2(30) NOT NULL,
    stanowisko           VARCHAR2(30) NOT NULL,
    wynagrodzenie        NUMBER(6, 2) NOT NULL,
    data_zatrudnienia    DATE NOT NULL,
    wymiar_godzin_pracy  NUMBER(3) NOT NULL
);

ALTER TABLE prac_uczelni
    ADD CHECK ( plec LIKE 'Mezczyzna'
                OR plec LIKE 'Kobieta'
                OR plec LIKE 'Other' );

ALTER TABLE prac_uczelni
    ADD CHECK ( stanowisko IN (
        SELECT
            nazwa_stanowiska
        FROM
            stanowiska
    ) );

ALTER TABLE prac_uczelni
    ADD CONSTRAINT chk_wynagrodz CHECK ( wynagrodzenie > (
            SELECT
                wynagrodzenie_od
            FROM
                stanowiska
            WHERE
                nazwa_stanowiska = prac_uczelni.stanowisko
        )
                                         AND wynagrodzenie < (
        SELECT
            wynagrodzenie_do
        FROM
            stanowiska
        WHERE
            nazwa_stanowiska = prac_uczelni.stanowisko
    ) );

ALTER TABLE prac_uczelni
    ADD CHECK ( wymiar_godzin_pracy <= 160
                AND wymiar_godzin_pracy >= 40 );

CREATE UNIQUE INDEX pracownik__idx ON
    prac_uczelni (
        id_pracowniku
    ASC );

ALTER TABLE prac_uczelni ADD CONSTRAINT prac_uczelni_pk PRIMARY KEY ( id_pracowniku,
                                                                      prac_uczelni_id );

ALTER TABLE prac_uczelni ADD CONSTRAINT prac_uczelni_id_pracowniku_un UNIQUE ( id_pracowniku );

CREATE TABLE przedmioty (
    kierunki_id_kierunku  INTEGER NOT NULL,
    id_przedmiotu         INTEGER NOT NULL,
    nazwa                 VARCHAR2(50) NOT NULL,
    punkty_ects           NUMBER(2) NOT NULL,
    semestry_id_semestru  INTEGER NOT NULL
);

ALTER TABLE przedmioty ADD CONSTRAINT przedmiot_pk PRIMARY KEY ( id_przedmiotu );

CREATE TABLE przedmioty_prac_uczelni (
    pracownik_id_pracowniku   INTEGER NOT NULL,
    przedmiot_id_przedmiotu   INTEGER NOT NULL,
    pracownicy_uczelni_pesel  NUMBER(11) NOT NULL
);

ALTER TABLE przedmioty_prac_uczelni
    ADD CONSTRAINT relation_5_pk PRIMARY KEY ( pracownik_id_pracowniku,
                                               przedmiot_id_przedmiotu,
                                               pracownicy_uczelni_pesel );

CREATE TABLE roki (
    id_roku                INTEGER NOT NULL,
    data_rozpoczecia_roku  DATE NOT NULL,
    stopien                VARCHAR2(15) NOT NULL,
    forma_studiow          VARCHAR2(30) NOT NULL,
    data_zakonczenia       DATE NOT NULL
);

ALTER TABLE roki ADD CONSTRAINT rok_pk PRIMARY KEY ( id_roku );

CREATE TABLE semestry (
    id_semestru      INTEGER NOT NULL,
    numer_semestru   NUMBER(1) NOT NULL,
    sum_liczba_ects  NUMBER(4) NOT NULL,
    dla_przekr_ects  NUMBER(4) NOT NULL
);

ALTER TABLE semestry ADD CONSTRAINT semestr_pk PRIMARY KEY ( id_semestru );

CREATE TABLE semestry_roki (
    "studenci na roku_id_roku"  INTEGER NOT NULL,
    semestry_id_semestru        INTEGER NOT NULL
);

ALTER TABLE semestry_roki ADD CONSTRAINT semestry_roki PRIMARY KEY ( "studenci na roku_id_roku",
                                                                     semestry_id_semestru );

CREATE TABLE stanowiska (
    nazwa_stanowiska  VARCHAR2(30) NOT NULL,
    wynagrodzenie_od  NUMBER(6, 2) NOT NULL,
    wynagrodzenie_do  NUMBER(6, 2) NOT NULL
);

ALTER TABLE stanowiska ADD CONSTRAINT stanowisko_pk PRIMARY KEY ( nazwa_stanowiska );

CREATE TABLE statusy (
    nazwa_statusu VARCHAR2(30) NOT NULL
);

ALTER TABLE statusy ADD CONSTRAINT status_pk PRIMARY KEY ( nazwa_statusu );

CREATE TABLE studenci (
    nr_indeksu            NUMBER(6) NOT NULL,
    pesel                 NUMBER(11) NOT NULL,
    imie                  VARCHAR2(50) NOT NULL,
    nazwisko              VARCHAR2(50) NOT NULL,
    plec                  VARCHAR2(20) NOT NULL,
    adres                 VARCHAR2(150) NOT NULL,
    data_urodzenia        DATE NOT NULL,
    telefon               VARCHAR2(30),
    data_rekrutacji       DATE NOT NULL,
    data_zakończenia      DATE NOT NULL,
    status                VARCHAR2(30) NOT NULL,
    grupa_dziekanska      VARCHAR2(15) NOT NULL,
    biezace_punkty__ects  NUMBER(4) NOT NULL,
    srednia_z_ocen        NUMBER(1, 5) NOT NULL,
    semestry_id_semestru  INTEGER NOT NULL,
    narodowosc            VARCHAR2(50) NOT NULL
);

ALTER TABLE studenci
    ADD CHECK ( srednia_z_ocen >= 2
                AND srednia_z_ocen <= 5 );

CREATE UNIQUE INDEX student__idx ON
    studenci (
        nr_indeksu
    ASC );

ALTER TABLE studenci ADD CONSTRAINT student_pk PRIMARY KEY ( nr_indeksu );

ALTER TABLE studenci ADD CONSTRAINT studenci__un UNIQUE ( pesel );

CREATE TABLE tytuly (
    nazwa_tytulu VARCHAR2(30) NOT NULL
);

ALTER TABLE tytuly ADD CONSTRAINT tytuł_pk PRIMARY KEY ( nazwa_tytulu );

CREATE TABLE wydzialy (
    id_wydzialu     INTEGER NOT NULL,
    nazwa_wydziału  VARCHAR2(50) NOT NULL
);

ALTER TABLE wydzialy ADD CONSTRAINT wydział_pk PRIMARY KEY ( id_wydzialu );

ALTER TABLE kierunki
    ADD CONSTRAINT kierunki_wydziały_fk FOREIGN KEY ( wydziały_id_wydziału )
        REFERENCES wydzialy ( id_wydzialu );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_prac_uczelni_fk FOREIGN KEY ( pracownicy_id_pracowniku,
                                                       prac_uczelni_prac_uczelni_id )
        REFERENCES prac_uczelni ( id_pracowniku,
                                  prac_uczelni_id );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_przedmioty_fk FOREIGN KEY ( przedmioty_id_przedmiotu )
        REFERENCES przedmioty ( id_przedmiotu );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_studenci_fk FOREIGN KEY ( student_nr_indeksu )
        REFERENCES studenci ( nr_indeksu );

ALTER TABLE przedmioty
    ADD CONSTRAINT przedmioty_kierunki_fk FOREIGN KEY ( kierunki_id_kierunku )
        REFERENCES kierunki ( id_kierunku );

ALTER TABLE przedmioty
    ADD CONSTRAINT przedmioty_semestry_fk FOREIGN KEY ( semestry_id_semestru )
        REFERENCES semestry ( id_semestru );

ALTER TABLE przedmioty_prac_uczelni
    ADD CONSTRAINT relation_5_pracownik_fk FOREIGN KEY ( pracownik_id_pracowniku )
        REFERENCES prac_uczelni ( id_pracowniku );

ALTER TABLE przedmioty_prac_uczelni
    ADD CONSTRAINT relation_5_przedmiot_fk FOREIGN KEY ( przedmiot_id_przedmiotu )
        REFERENCES przedmioty ( id_przedmiotu );

ALTER TABLE semestry_roki
    ADD CONSTRAINT sem_roki_roki_fk FOREIGN KEY ( "studenci na roku_id_roku" )
        REFERENCES roki ( id_roku );

ALTER TABLE semestry_roki
    ADD CONSTRAINT sem_roki_semestry_fk FOREIGN KEY ( semestry_id_semestru )
        REFERENCES semestry ( id_semestru );

ALTER TABLE studenci
    ADD CONSTRAINT studenci_semestry_fk FOREIGN KEY ( semestry_id_semestru )
        REFERENCES semestry ( id_semestru );

CREATE SEQUENCE prac_uczelni_prac_uczelni_id START WITH 1 NOCACHE ORDER;

CREATE OR REPLACE TRIGGER prac_uczelni_prac_uczelni_id BEFORE
    INSERT ON prac_uczelni
    FOR EACH ROW
    WHEN ( new.prac_uczelni_id IS NULL )
BEGIN
    :new.prac_uczelni_id := prac_uczelni_prac_uczelni_id.nextval;
END;
/



-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                            13
-- CREATE INDEX                             2
-- ALTER TABLE                             32
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           1
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          1
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- TSDP POLICY                              0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0
